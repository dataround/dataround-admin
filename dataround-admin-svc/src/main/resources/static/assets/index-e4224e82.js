import{r as l,A as L,_ as Y,F as o,k as f,v as G,n as E,w as J,x as Q,l as W,j as t,T as X,B as j,o as Z,q as g,S as ee}from"./index-92514c79.js";import{T as te,M as se,S as F,E as ae,P as ne}from"./EditOutlined-0b8e7fe2.js";import"./DownOutlined-1f22e0cf.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};const le=re;var ie=function(b,x){return l.createElement(L,Y({},b,{ref:x,icon:le}))},de=l.forwardRef(ie);const oe=de;let r=null;const ce=()=>{const[m]=o.useForm(),[b,x]=l.useState(0),[w,I]=l.useState(!1),[D,k]=l.useState("新建项目"),[v,q]=l.useState([]),[z,M]=l.useState([]),[U,P]=l.useState(0),[S,T]=l.useState(10),R=[{title:"项目Id",dataIndex:"key",key:"key"},{title:"项目名",dataIndex:"name",key:"name"},{title:"项目管理员",key:"adminNames",render:(e,s)=>s.adminNames.join(", ")},{title:"描述",dataIndex:"description",key:"description"},{title:"创建者",dataIndex:"createUser",key:"createUser"},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",render:(e,s)=>t.jsxs(ee,{size:"small",children:[t.jsxs(j,{type:"link",style:{padding:0,gap:"4px"},onClick:()=>N(s),children:[t.jsx(ae,{}),"编辑"]}),t.jsx(ne,{title:"确认删除？",onConfirm:()=>_(s),children:t.jsxs(j,{type:"link",style:{padding:0,gap:"4px"},children:[t.jsx(oe,{}),"删除"]})})]})}],O=f(G,{wrapperFun:e=>{T(e.size),P(e.total),r=e.records;const s=[];return Object.keys(r).forEach(n=>{const u=[],i=[];r[n].admins.forEach(c=>{u.push(c.userId),i.push(c.userName)});const p=[];r[n].members.forEach(c=>{p.push(c.userId)}),s.push({key:r[n].id,name:r[n].name,description:r[n].description,adminIds:u,memberIds:p,adminNames:i,createUser:r[n].createUser,createTime:r[n].createTime})}),M(s),s}});l.useEffect(()=>{O.caller({size:S}),$.caller({size:100})},[b]);const A=[{key:"key1",label:"项目列表"}],H=()=>{k("新建项目"),a.name="",a.description="",a.adminIds=[],a.memberIds=[],m.setFieldsValue(a),I(!0)},B=f(J,{wrapperFun:e=>{E.success("项目保存成功"),I(!1),x(Math.random)}}),N=e=>{k("编辑项目"),a.id=e.key,a.name=e.name,a.description=e.description,a.adminIds=e.adminIds,a.memberIds=e.memberIds,m.setFieldsValue(a),I(!0)},_=e=>{V.caller(e.key).then(()=>{x(Math.random)})},V=f(Q,{wrapperFun:e=>{E.success("项目删除成功")}}),C=()=>{m.validateFields().then(e=>{const s=e.memberIds,n=e.adminIds,u=[],i=r==null?void 0:r.find(d=>d.id===e.id);s.map(d=>{const h=i==null?void 0:i.members.find(y=>y.userId===d);u.push(h||{userId:d})});const p=[];n.map(d=>{const h=i==null?void 0:i.admins.find(y=>y.userId===d);p.push(h||{userId:d,isAdmin:!0})});const c={...e,members:u,admins:p};B.caller(c)})},$=f(W,{wrapperFun:e=>{const s=[];return e.records.forEach(n=>{s.push({label:n.name,value:n.id})}),q(s),s}}),a={id:"",name:"",description:"",adminIds:[],memberIds:[]},K=(e,s)=>{T(s),O.caller({current:e,size:s})};return t.jsxs(t.Fragment,{children:[t.jsx(X,{defaultActiveKey:"1",items:A,tabBarExtraContent:t.jsx(j,{type:"primary",htmlType:"submit",onClick:H,children:"新建项目"})}),t.jsx(te,{size:"small",columns:R,dataSource:z,pagination:{pageSize:S,total:U,onChange:K}}),t.jsx(se,{title:D,open:w,onCancel:()=>I(!1),onOk:C,cancelText:"取消",okText:"确定",width:"45%",style:{top:100,height:"80vh"},bodyStyle:{maxHeight:"70vh",overflowY:"auto"},children:t.jsx(Z,{children:t.jsxs(o,{form:m,labelCol:{span:4},wrapperCol:{span:18},initialValues:a,onFinish:C,children:[t.jsx(o.Item,{label:"id",name:"id",style:{display:"none"},children:t.jsx(g,{})}),t.jsx(o.Item,{label:"项目名",name:"name",rules:[{required:!0,message:"请输入项目名"}],children:t.jsx(g,{placeholder:"请输入项目名"})}),t.jsx(o.Item,{label:"项目描述",name:"description",children:t.jsx(g.TextArea,{placeholder:"请输入项目描述"})}),t.jsx(o.Item,{label:"项目管理员",name:"adminIds",rules:[{required:!0,message:"请选择项目管理员"}],children:t.jsx(F,{mode:"multiple",options:v})}),t.jsx(o.Item,{label:"项目成员",name:"memberIds",rules:[{required:!0,message:"请选择项目成员"}],children:t.jsx(F,{mode:"multiple",options:v})})]})})})]})},xe=l.memo(ce);export{xe as default};
